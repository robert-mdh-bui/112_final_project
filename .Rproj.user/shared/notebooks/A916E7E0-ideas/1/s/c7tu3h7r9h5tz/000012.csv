"0","dt <- data %>% "
"0","  select(release_name,pass,imdb_genre1,imdb_genre2,imdb_genre3)"
"0","dt[is.na(dt)]<- 0"
"0",""
"0","gr <- unique(c(dt$imdb_genre1,"
"0","               dt$imdb_genre2,"
"0","               dt$imdb_genre3"
"0","               ),na.rm=TRUE)"
"0","gr <- gr[!is.na(gr)]"
"0",""
"0","for (i in gr){"
"0","  dt[i] <- ifelse(dt$imdb_genre1==paste(i)| "
"0","                dt$imdb_genre2==paste(i)| "
"0","                dt$imdb_genre3==paste(i), 1, 0)"
"0","}"
"0",""
"0","dt1 <- dt %>% "
"0","  select(-c(release_name,imdb_genre1,imdb_genre2,imdb_genre3,`0`)) %>% "
"0","  pivot_longer("
"0","    cols = -c(pass),"
"0","    names_to = ""genre"","
"0","    values_to = ""value"""
"0","  ) %>% "
"0","  group_by(pass,genre) %>% "
"0","  summarise("
"0","    n=sum(value)"
"0","  )"
"0",""
"0","dt2 <- dt1 %>%"
"0","  pivot_wider("
"0","    id_cols = genre,"
"0","    names_from = pass,"
"0","    names_prefix = ""p"","
"0","    values_from = n"
"0","  ) %>%"
"0","  mutate("
"0","    passprop=pTRUE/(pFALSE+pTRUE)"
"0","  ) %>% "
"0","  arrange(passprop)"
"0",""
"0","p <- dt1 %>% "
"0","  ggplot()+"
"0","  geom_col(aes(x=fct_reorder(genre,n), y=n,fill=pass), position=""stack"")+"
"0","  coord_flip()+"
"0","  labs("
"0","    title = ""Genres by number of films in 2018*"","
"0","    caption = ""*If a film belongs to more than one genre, then it is counted as an entry for all those genres."","
"0","    x = ""Genre"","
"0","    y = ""Number of films"""
"0","  )+"
"0","  theme_economist()+"
"0","  scale_fill_economist("
"0","    name=""Vito Russo Test Passing Status"","
"0","    labels=c(""Fail"",""Pass"")"
"0","  )"
"0",""
"0","p2 <- dt1 %>% "
"0","  filter("
"0","    !genre %in% c(""Western"",""War"",""Sport"",""Sci-Fi"",""Fantasy"",""Family"",""Animation"")"
"0","  ) %>% "
"0","  ggplot()+"
"0","  geom_col(aes(x=factor(genre,dt2$genre), y=n,fill=pass), position=""fill"")+"
"0","  coord_flip()+"
"0","  labs("
"0","    title = ""Genres by proportion of passing films in 2018*"","
"0","    caption = ""*If a film belongs to more than one genre, then it is counted as an entry for all those genres. Genres with no passing entries are omitted."","
"0","    x = ""Genre"","
"0","    y = ""Ratio"""
"0","  )+"
"0","  theme_economist()+"
"0","  scale_fill_economist("
"0","    name=""Vito Russo Test Passing Status"","
"0","    labels=c(""Fail"",""Pass"")"
"0","  )"
"0",""
"0","p"
